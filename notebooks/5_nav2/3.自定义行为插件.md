# 自定义行为(Behavior)插件
在[2.编写新的行为树插件](./2.编写新的行为树插件.md)创建的以一个action为基础的*行为树节点*的功能只是作为行为树的一部分,并不涉及具体执行动作,
原因是行为树节点被要求是*非阻塞的*,因此具体动作的执行要通过对应的`Behavior server ros2 节点` 完成. 一个`Behavior server`是一个接受`ros2 action`请求,执行动作,并返回动作执行结果的`ros2 node`.

我们可以直接编写一个包含`action client`的节点作为`Behavior server`,也可以通过继承nav2提供的`nav2_behaviors::TimedBehavior`类编写并注册为一个
Behavior plugin,由 `nav2 behavior server`代为执行

## 编写 ros2 节点 作为 behavior server
要通过编写 ros2 节点 作为 behavior server,我们要为每一个注册的*行为树节点* 编写一个包含对应`action client`的ros2节点作为行为服务器,并在launch时运行.
行为服务器应当包含 action client 的多种callback函数并设置函数返回值
```python
    def goal_callback(self, goal_request):
        """Accept or reject a client request to begin an action."""
        self.get_logger().info('Received goal request')
        return GoalResponse.ACCEPT
    def handle_accepted_callback(self, goal_handle):
        """Provide a handle to an accepted goal.当一个目标被接受后，这个方法被调用。"""
        self.get_logger().info('execution...')
        self._goal_handle = goal_handle
        self._goal_handle.execute()

    def execute_callback(self, goal_handle):
        """execute action"""
        goal_handle.succeed()
        result = PutBall.Result()
        return result
    def cancel_callback(self, goal_handle):
        """Accept or reject a client request to cancel an action."""
        self.get_logger().info(f'Received cancel request {id(goal_handle)}')
        return CancelResponse.ACCEPT
```
